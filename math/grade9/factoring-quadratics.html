<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Factoring Quadratics</title>
<style>
:root{
    --bg:#f7fbff; --panel:#fff; --accent:#10b981; --accent2:#059669; --ok:#16a34a; --bad:#ef4444; --muted:#566270;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter, "Segoe UI", Arial, sans-serif;background:var(--bg);color:#04263b;}
header{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;padding:22px 12px;text-align:center;border-radius:0 0 12px 12px}
header h1{margin:0;font-size:clamp(20px,3vw,30px)}
main{max-width:1100px;margin:20px auto;padding:14px}
section{background:var(--panel);border-radius:12px;padding:16px;margin:14px 0;box-shadow:0 8px 24px rgba(2,6,23,0.06)}
h2{color:var(--accent2);margin:0 0 10px 0}
p{margin:8px 0}
ul{margin:8px 0;padding-left:20px}
li{margin-bottom:4px}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
button{background:var(--accent2);color:#fff;border:none;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
button.secondary{background:#10b981;color:#fff}
button.ghost{background:#d1fae5;color:var(--accent2);border:1px solid #a7f3d0}
button.warn{background:#f97316}
input[type=number], input[type=text], select{padding:8px;border-radius:8px;border:1px solid #a7f3d0;font-size:1rem;min-width:100px;}
.grid{display:grid;gap:10px}
.grid.cols-4{grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}
.tile{background:#fff;padding:12px;border-radius:8px;text-align:center;border:1px solid #a7f3d0;font-weight:700}
.status{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.pill{background:#e6ffef;color:var(--ok);padding:6px 10px;border-radius:999px;font-weight:800}
.muted{color:var(--muted)}
footer{text-align:center;padding:12px;margin-top:8px;color:#334155}
.answer{font-weight:800;margin-top:8px}
.ok{color:var(--ok)}
.bad{color:var(--bad)}
canvas{background:#fff;border:1px solid #a7f3d0;border-radius:8px;display:block;margin-top:10px;width:100%;}
.video-container { position: relative; width: 100%; }
.video-container canvas { margin-bottom: 8px; }
.captions-box {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #fefcbf;
    color: #000;
    padding: 10px 15px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    font-size: 0.9rem;
    max-width: 80%;
    text-align: center;
    visibility: hidden;
    transition: visibility 0s, opacity 0.5s linear;
    opacity: 0;
}
.captions-box.visible {
    visibility: visible;
    opacity: 1;
}
</style>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>
<body>
<header>
<h1>Factoring Quadratics 📊</h1>
<p style="margin:6px 0 0 0;opacity:.95">Interactive Tutorial • Practice Problems • Speed Quiz</p>
</header>
<main>
<section aria-labelledby="introTitle">
<h2 id="introTitle">What is Factoring? 🕵️‍♂️</h2>
<p>
    Factoring a **quadratic expression** is the reverse of multiplying polynomials. It means breaking a quadratic equation of the form $ax^2 + bx + c$ into a product of two simpler expressions, usually binomials like $(x+p)(x+q)$.
</p>
<p>
    This skill is essential for solving quadratic equations and simplifying complex algebraic expressions. Pay close attention to the video, as it will visually guide you through the process of finding the right numbers.
</p>
<div class="status" style="margin-top:8px">
  <div class="pill" id="score">Score: 0</div>
  <div class="muted" id="streak">Streak: 0</div>
</div>
</section>

<section aria-labelledby="videoTitle">
<h2 id="videoTitle">Video: Factoring Quadratics 🎬</h2>
<p>This video will walk you through factoring a basic trinomial and a difference of squares. Make sure to turn on the captions to follow along with the audio!</p>
<div class="video-container">
  <canvas id="tutorialCanvas" width="800" height="400"></canvas>
  <div class="captions-box" id="captionsBox"></div>
</div>
<div class="controls" style="margin-top:10px">
  <button id="playTutorial" class="secondary">▶️ Play Video</button>
  <div class="settings">
    <label>Speed: <input type="number" id="videoSpeed" value="1" min="0.5" max="2" step="0.1"></label>
  </div>
  <div class="settings">
    <label>Volume: <input type="range" id="videoVolume" min="0" max="1" value="1" step="0.1"></label>
  </div>
  <div class="settings">
    <label><input type="checkbox" id="captionsToggle"> Captions</label>
  </div>
</div>
</section>

<section aria-labelledby="practiceTitle">
<h2 id="practiceTitle">Practice Problems</h2>
<p>Factor the expressions below. Enter your answers in the form (x+p)(x+q). Order does not matter.</p>
<div class="grid cols-4" style="margin-top:10px">
    <div class="tile" id="q1.tile">
        <div style="font-weight:700">1) Factor: <br> $x^2 + 7x + 12$ </div>
        <p>Answer: <input id="q1_ans" type="text" placeholder="?"></p>
        <div style="margin-top:6px"><button onclick="check('q1', '(x+3)(x+4)')">Check</button></div>
        <div id="r1" class="answer"></div>
    </div>
    <div class="tile" id="q2.tile">
        <div style="font-weight:700">2) Factor: <br> $x^2 - 16$ </div>
        <p>Answer: <input id="q2_ans" type="text" placeholder="?"></p>
        <div style="margin-top:6px"><button onclick="check('q2', '(x+4)(x-4)')">Check</button></div>
        <div id="r2" class="answer"></div>
    </div>
    <div class="tile" id="q3.tile">
        <div style="font-weight:700">3) Factor: <br> $x^2 - 2x - 8$ </div>
        <p>Answer: <input id="q3_ans" type="text" placeholder="?"></p>
        <div style="margin-top:6px"><button onclick="check('q3', '(x-4)(x+2)')">Check</button></div>
        <div id="r3" class="answer"></div>
    </div>
    <div class="tile" id="q4.tile">
        <div style="font-weight:700">4) Factor: <br> $2x^2 + 10x + 12$ </div>
        <p>Answer: <input id="q4_ans" type="text" placeholder="?"></p>
        <div style="margin-top:6px"><button onclick="check('q4', '2(x+2)(x+3)')">Check</button></div>
        <div id="r4" class="answer"></div>
    </div>
</div>
</section>

<section aria-labelledby="speedTitle">
<h2 id="speedTitle">⚡ Factoring Speed Quiz</h2>
<div class="controls">
  <label>Duration:
    <select id="quizDuration">
      <option value="30">30s</option>
      <option value="60" selected>60s</option>
      <option value="90">90s</option>
    </select>
  </label>
  <button id="startQuiz" class="warn">Start Quiz</button>
  <button id="stopQuiz" class="ghost">Stop</button>
  <div class="muted" id="quizTimer">Time: 0</div>
  <div id="quizScore" class="pill">Correct: 0</div>
</div>
<div style="margin-top:12px">
  <div style="font-size:1.6rem;font-weight:800" id="quizQ">Press Start</div>
  <div style="margin-top:8px" class="controls">
    <input id="quizInput_ans" type="text" placeholder="Answer = ?">
    <button id="quizCheck" class="secondary">Submit</button>
    <div id="quizFeedback" class="answer"></div>
  </div>
</div>
</section>

<section aria-labelledby="csvTitle">
<h2 id="csvTitle">Download CSV Log</h2>
<p>Track all practice & quiz answers in a CSV file.</p>
<button id="downloadCSVBtn" class="secondary">⬇️ Download CSV</button>
</section>

<footer>You've got this! Practice makes perfect.</footer>
</main>
<script>
/* ===== Utilities ===== */
const tone = (f = 880, d = 0.06) => {
    try {
        const A = new (window.AudioContext || window.webkitAudioContext)();
        const o = A.createOscillator();
        const g = A.createGain();
        o.type = 'sine';
        o.frequency.value = f;
        g.gain.value = 0.0001;
        o.connect(g);
        g.connect(A.destination);
        o.start();
        g.gain.exponentialRampToValueAtTime(0.12, A.currentTime + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, A.currentTime + d);
        setTimeout(() => { o.stop(); A.close().catch(() => {}); }, d * 1000 + 50);
    } catch (e) {}
};
let totalScore = 0, streak = 0, csvData = [['Question', 'User Answer', 'Correct Answer']];
function normalizeAnswer(ans) {
    let cleanAns = ans.replace(/\s/g, '').toLowerCase();
    // Handle (x+a)(x+b) vs (x+b)(x+a)
    const match = cleanAns.match(/\((\S+)\)\((\S+)\)/);
    if (match) {
        const p1 = match[1];
        const p2 = match[2];
        if (p1 > p2) {
            return `(${p2})(${p1})`;
        }
    }
    return cleanAns;
}
window.check = (qId, correct) => {
    const res = document.getElementById('r' + qId.slice(1));
    const input = document.getElementById(qId + '_ans');
    const userAnswer = normalizeAnswer(input.value);
    const correctAnswer = normalizeAnswer(correct);
    let isCorrect = userAnswer === correctAnswer;
    
    const questionText = document.querySelector(`#${qId}\\.tile div`).textContent;
    csvData.push([questionText, input.value.trim(), correct]);
    
    if (isCorrect) {
        res.textContent = '✅ Correct!';
        res.className = 'answer ok';
        tone(880, 0.06);
        updateScore(1);
    } else {
        res.textContent = `❌ Wrong (Answer: ${correct})`;
        res.className = 'answer bad';
        tone(220, 0.06);
        updateScore(0);
    }
};
function updateScore(points) {
    if (points > 0) {
        totalScore += points;
        streak++;
    } else {
        streak = 0;
    }
    document.getElementById('score').textContent = `Score: ${totalScore}`;
    document.getElementById('streak').textContent = `Streak: ${streak}`;
}
/* ===== Canvas Tutorial ===== */
const tutorialCanvas = document.getElementById('tutorialCanvas');
const ctx = tutorialCanvas.getContext('2d');
const tutorialSpeedInput = document.getElementById('videoSpeed');
const videoVolumeInput = document.getElementById('videoVolume');
const captionsToggle = document.getElementById('captionsToggle');
const captionsBox = document.getElementById('captionsBox');
const voice = window.speechSynthesis.getVoices().find(v => v.name.includes('female') || v.name.includes('F'));
function drawText(ctx, text, x, y, color) {
    ctx.fillStyle = color;
    ctx.font = '24px Inter, sans-serif';
    ctx.fillText(text, x, y);
}
function drawLesson(step) {
    ctx.clearRect(0, 0, tutorialCanvas.width, tutorialCanvas.height);
    if (step.draw) {
        step.draw(ctx);
    }
}
function drawCircle(ctx, x, y, radius, color) {
    ctx.beginPath();
    ctx.arc(x, y, radius, 0, 2 * Math.PI, false);
    ctx.fillStyle = color;
    ctx.fill();
}
function drawLine(ctx, x1, y1, x2, y2, color, thickness) {
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.strokeStyle = color;
    ctx.lineWidth = thickness;
    ctx.stroke();
}
const tutorialSteps = [
    {
        audio: "Welcome to our tutorial on factoring quadratics.",
        draw: (ctx) => drawText(ctx, "Factoring Quadratics", tutorialCanvas.width / 2, tutorialCanvas.height / 2, '#04263b')
    },
    {
        audio: "A quadratic expression is in the form of a x squared plus b x plus c. Your goal is to find two numbers that multiply to c and add to b.",
        draw: (ctx) => {
            const math = "$$ax^2 + bx + c$$";
            MathJax.typesetPromise().then(() => {
                const mathDiv = document.createElement('div');
                mathDiv.innerHTML = math;
                mathDiv.style.cssText = 'position: absolute; top: 100px; left: 50%; transform: translateX(-50%); font-size: 24px;';
                tutorialCanvas.parentNode.appendChild(mathDiv);
            });
        }
    },
    {
        audio: "Let's take the example of x squared plus 5x plus 6.",
        draw: (ctx) => {
            ctx.clearRect(0, 0, tutorialCanvas.width, tutorialCanvas.height);
            drawText(ctx, "$$x^2 + 5x + 6$$", tutorialCanvas.width / 2, 100, '#04263b');
        }
    },
    {
        audio: "We need two numbers that multiply to six and add to five. Let's list the pairs that multiply to six: one and six, and two and three.",
        draw: (ctx) => {
            ctx.clearRect(0, 0, tutorialCanvas.width, tutorialCanvas.height);
            drawText(ctx, "$$x^2 + 5x + 6$$", tutorialCanvas.width / 2, 100, '#04263b');
            drawText(ctx, "Multiply to 6:", 200, 200, '#04263b');
            drawText(ctx, "Add to 5:", 600, 200, '#04263b');
            drawText(ctx, "1, 6", 200, 240, '#04263b');
            drawText(ctx, "2, 3", 200, 280, '#04263b');
        }
    },
    {
        audio: "Of those pairs, two and three add up to five. So, our numbers are two and three.",
        draw: (ctx) => {
            ctx.clearRect(0, 0, tutorialCanvas.width, tutorialCanvas.height);
            drawText(ctx, "$$x^2 + 5x + 6$$", tutorialCanvas.width / 2, 100, '#04263b');
            drawText(ctx, "Multiply to 6:", 200, 200, '#04263b');
            drawText(ctx, "Add to 5:", 600, 200, '#04263b');
            drawText(ctx, "1 + 6 = 7", 600, 240, '#ef4444');
            drawText(ctx, "2 + 3 = 5", 600, 280, '#16a34a');
        }
    },
    {
        audio: "This means the factored form is x plus 2 times x plus 3.",
        draw: (ctx) => {
            ctx.clearRect(0, 0, tutorialCanvas.width, tutorialCanvas.height);
            drawText(ctx, "$$(x + 2)(x + 3)$$", tutorialCanvas.width / 2, 150, '#04263b');
        }
    },
    {
        audio: "Factoring a difference of squares is a special case. For example, x squared minus 16. The factored form is x plus 4 times x minus 4.",
        draw: (ctx) => {
            ctx.clearRect(0, 0, tutorialCanvas.width, tutorialCanvas.height);
            drawText(ctx, "$$x^2 - 16$$", tutorialCanvas.width / 2, 100, '#04263b');
            drawText(ctx, "equals", tutorialCanvas.width / 2, 150, '#04263b');
            drawText(ctx, "$$(x + 4)(x - 4)$$", tutorialCanvas.width / 2, 200, '#04263b');
        }
    }
];
let tutorialIndex = 0;
let lastMathDiv = null;
async function playTutorialVideo() {
    if (speechSynthesis.speaking) return;
    tutorialIndex = 0;
    const speed = parseFloat(tutorialSpeedInput.value) || 1;
    const volume = parseFloat(videoVolumeInput.value) || 1;
    const showCaptions = captionsToggle.checked;
    function nextStep() {
        if (tutorialIndex >= tutorialSteps.length) {
            if (lastMathDiv) lastMathDiv.remove();
            captionsBox.textContent = '';
            captionsBox.classList.remove('visible');
            return;
        }
        const step = tutorialSteps[tutorialIndex];
        const utterance = new SpeechSynthesisUtterance(step.audio);
        utterance.rate = speed;
        utterance.pitch = 1.2;
        utterance.volume = volume;
        if (voice) utterance.voice = voice;
        utterance.onend = () => {
            tutorialIndex++;
            nextStep();
        };
        utterance.onerror = () => {
            tutorialIndex++;
            nextStep();
        };
        if (lastMathDiv) lastMathDiv.remove();
        drawLesson(step);
        if (showCaptions) {
            captionsBox.textContent = step.audio;
            captionsBox.classList.add('visible');
        } else {
            captionsBox.textContent = '';
            captionsBox.classList.remove('visible');
        }
        speechSynthesis.speak(utterance);
    }
    nextStep();
}
document.getElementById('playTutorial').addEventListener('click', () => playTutorialVideo());
videoVolumeInput.addEventListener('input', () => {
    // Volume is handled directly in the `playTutorialVideo` function on each step.
});
captionsToggle.addEventListener('change', () => {
    // Captions are handled in the `playTutorialVideo` function.
    if (!captionsToggle.checked) {
        captionsBox.classList.remove('visible');
    } else {
        // If already speaking, show current step captions.
        if (speechSynthesis.speaking) {
            const currentStep = tutorialSteps[tutorialIndex - 1] || tutorialSteps[0];
            captionsBox.textContent = currentStep.audio;
            captionsBox.classList.add('visible');
        }
    }
});
ctx.font = '24px Inter, sans-serif';
ctx.textAlign = 'center';
ctx.fillText("Press Play to start the video!", tutorialCanvas.width / 2, tutorialCanvas.height / 2);
/* ===== Speed Quiz ===== */
function generateProblem() {
    const problemType = ['factor', 'diff_squares'][Math.floor(Math.random() * 2)];
    let q, a;
    if (problemType === 'factor') {
        const p = Math.floor(Math.random() * 10) - 5;
        const q_val = Math.floor(Math.random() * 10) - 5;
        const b = p + q_val;
        const c = p * q_val;
        const b_sign = b >= 0 ? '+' : '-';
        const c_sign = c >= 0 ? '+' : '-';
        const b_abs = Math.abs(b);
        const c_abs = Math.abs(c);
        q = `Factor: $x^2 ${b_sign} ${b_abs}x ${c_sign} ${c_abs}$`;
        a = `(x${p > 0 ? '+' : ''}${p})(x${q_val > 0 ? '+' : ''}${q_val})`;
        if (p===0) a = `x(x+${q_val})`
        if (q_val===0) a = `x(x+${p})`
    } else if (problemType === 'diff_squares') {
        const c = Math.floor(Math.random() * 4) + 2;
        q = `Factor: $x^2 - ${c*c}$`;
        a = `(x+${c})(x-${c})`;
    }
    return { q: q, a: a.toLowerCase().replace(/\s/g, '') };
}
let quizTimerInt = null, quizTime = 0, quizScore = 0, currentQuiz = null;
function newQuizQuestion() {
    const problem = generateProblem();
    currentQuiz = problem;
    const qEl = document.getElementById('quizQ');
    qEl.textContent = currentQuiz.q;
    // Update MathJax
    MathJax.typesetPromise([qEl]);
    document.getElementById('quizInput_ans').value = '';
    document.getElementById('quizFeedback').textContent = '';
}
document.getElementById('startQuiz').addEventListener('click', () => {
    quizTime = parseInt(document.getElementById('quizDuration').value, 10);
    quizScore = 0;
    document.getElementById('quizScore').textContent = `Correct: ${quizScore}`;
    newQuizQuestion();
    clearInterval(quizTimerInt);
    quizTimerInt = setInterval(() => {
        quizTime--;
        document.getElementById('quizTimer').textContent = `Time: ${quizTime}s`;
        if (quizTime <= 0) {
            clearInterval(quizTimerInt);
            document.getElementById('quizQ').textContent = 'Time Up!';
        }
    }, 1000);
});
document.getElementById('stopQuiz').addEventListener('click', () => {
    clearInterval(quizTimerInt);
});
document.getElementById('quizCheck').addEventListener('click', () => {
    const val = normalizeAnswer(document.getElementById('quizInput_ans').value);
    const f = document.getElementById('quizFeedback');
    let userAnswer = val;
    let correctAnswer = normalizeAnswer(currentQuiz.a);
    
    if (userAnswer === correctAnswer) {
        f.textContent = '✅ Correct!';
        f.className = 'answer ok';
        quizScore++;
        document.getElementById('quizScore').textContent = `Correct: ${quizScore}`;
        tone(880, 0.06);
    } else {
        f.textContent = `❌ Wrong (Answer: ${currentQuiz.a})`;
        f.className = 'answer bad';
        tone(220, 0.06);
    }
    csvData.push([currentQuiz.q, document.getElementById('quizInput_ans').value, currentQuiz.a]);
    if (quizTime > 0) newQuizQuestion();
});
/* ===== CSV Download ===== */
document.getElementById('downloadCSVBtn').addEventListener('click', () => {
    const csvContent = "data:text/csv;charset=utf-8," + csvData.map(e => e.join(",")).join("\n");
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "factoring_log.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
});
</script>
</body>
</html>
