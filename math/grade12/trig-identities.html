<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Trigonometric Identities</title>
<style>
:root{
  --bg:#f7fbff; --panel:#fff; --accent:#60a5fa; --accent2:#1d4ed8; --ok:#16a34a; --bad:#ef4444; --muted:#566270;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter, "Segoe UI", Arial, sans-serif;background:var(--bg);color:#04263b;}
header{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;padding:22px 12px;text-align:center}
header h1{margin:0;font-size:clamp(20px,3vw,30px)}
main{max-width:1100px;margin:20px auto;padding:14px}
section{background:var(--panel);border-radius:12px;padding:16px;margin:14px 0;box-shadow:0 8px 24px rgba(2,6,23,0.06)}
h2{color:var(--accent2);margin:0 0 10px 0}
p{margin:8px 0}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
button{background:var(--accent2);color:#fff;border:none;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
button.secondary{background:#60a5fa;color:#fff}
button.ghost{background:#dbeafe;color:var(--accent2);border:1px solid #93c5fd}
button.warn{background:#f97316}
input[type=number], input[type=text], select{padding:8px;border-radius:8px;border:1px solid #93c5fd;font-size:1rem}
.grid{display:grid;gap:10px}
.grid.cols-4{grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}
.tile{background:#fff;padding:12px;border-radius:8px;text-align:center;border:1px solid #93c5fd;cursor:pointer;font-weight:700}
.status{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.pill{background:#e6ffef;color:var(--ok);padding:6px 10px;border-radius:999px;font-weight:800}
.muted{color:var(--muted)}
footer{text-align:center;padding:12px;margin-top:8px;color:#334155}
.answer{font-weight:800;margin-top:8px}
.ok{color:var(--ok)}
.bad{color:var(--bad)}
canvas{background:#fff;border:1px solid #93c5fd;border-radius:8px;display:block;margin-top:10px;width:100%;}
</style>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<header>
<h1>Trigonometric Identities üìê</h1>
<p style="margin:6px 0 0 0;opacity:.95">Interactive Tutorial ‚Ä¢ Practice Problems ‚Ä¢ Speed Quiz</p>
</header>
<main>
<section aria-labelledby="introTitle">
<h2 id="introTitle">What are Trig Identities? üîÑ</h2>
<p>
  A **trigonometric identity** is an equation involving trigonometric functions that is true for all values where the functions are defined. Think of them as fundamental rules that let you manipulate and simplify complex trig expressions. We'll explore the three main types:
</p>
<p>
  1.  **Reciprocal Identities:** The basic relationships between trig functions.
  <br>
  2.  **Quotient Identities:** How sine, cosine, and tangent relate.
  <br>
  3.  **Pythagorean Identities:** Derived from the Pythagorean theorem on the unit circle.
</p>
<div class="status" style="margin-top:8px">
  <div class="pill" id="score">Score: 0</div>
  <div class="muted" id="streak">Streak: 0</div>
</div>
</section>

<section aria-labelledby="videoTitle">
<h2 id="videoTitle">Video: The Unit Circle & Identities üé¨</h2>
<p>Watch this video to visualize where the Pythagorean identities come from.</p>
<div class="canvas-wrapper">
  <canvas id="tutorialCanvas" width="800" height="400"></canvas>
</div>
<div class="controls">
  <button id="playTutorial" class="secondary">‚ñ∂Ô∏è Play Video</button>
</div>
<div class="settings">
  <label>Speed: <input type="number" id="videoSpeed" value="1" min="0.5" max="2" step="0.1"></label>
</div>
</section>

<section aria-labelledby="practiceTitle">
<h2 id="practiceTitle">Practice Problems</h2>
<p>Match the expression to its simplified form using the fundamental identities.</p>
<div class="grid cols-4" style="margin-top:10px">
  <div class="tile">
    <div style="font-weight:700">1) What does $\sin^2\theta + \cos^2\theta$ equal?</div>
    <select id="q1">
      <option value="">Choose one...</option>
      <option value="1">1</option>
      <option value="tan(theta)">$\tan\theta$</option>
      <option value="sec(theta)">$\sec\theta$</option>
    </select>
    <div style="margin-top:6px"><button onclick="check('q1', '1')">Check</button></div>
    <div id="r1" class="answer"></div>
  </div>
  <div class="tile">
    <div style="font-weight:700">2) Simplify: $\frac{\sin\theta}{\cos\theta}$</div>
    <select id="q2">
      <option value="">Choose one...</option>
      <option value="1">1</option>
      <option value="tan(theta)">$\tan\theta$</option>
      <option value="cot(theta)">$\cot\theta$</option>
    </select>
    <div style="margin-top:6px"><button onclick="check('q2', 'tan(theta)')">Check</button></div>
    <div id="r2" class="answer"></div>
  </div>
  <div class="tile">
    <div style="font-weight:700">3) Simplify: $\frac{1}{\cos\theta}$</div>
    <select id="q3">
      <option value="">Choose one...</option>
      <option value="csc(theta)">$\csc\theta$</option>
      <option value="sec(theta)">$\sec\theta$</option>
      <option value="cot(theta)">$\cot\theta$</option>
    </select>
    <div style="margin-top:6px"><button onclick="check('q3', 'sec(theta)')">Check</button></div>
    <div id="r3" class="answer"></div>
  </div>
  <div class="tile">
    <div style="font-weight:700">4) What does $\sec^2\theta - \tan^2\theta$ equal?</div>
    <select id="q4">
      <option value="">Choose one...</option>
      <option value="1">1</option>
      <option value="cot(theta)">$\cot\theta$</option>
      <option value="tan(theta)">$\tan\theta$</option>
    </select>
    <div style="margin-top:6px"><button onclick="check('q4', '1')">Check</button></div>
    <div id="r4" class="answer"></div>
  </div>
</div>
</section>

<section aria-labelledby="speedTitle">
<h2 id="speedTitle">‚ö° Trig Identities Speed Quiz</h2>
<div class="controls">
  <label>Duration:
    <select id="quizDuration">
      <option value="30">30s</option>
      <option value="60" selected>60s</option>
      <option value="90">90s</option>
    </select>
  </label>
  <button id="startQuiz" class="warn">Start Quiz</button>
  <button id="stopQuiz" class="ghost">Stop</button>
  <div class="muted" id="quizTimer">Time: 0</div>
  <div id="quizScore" class="pill">Correct: 0</div>
</div>
<div style="margin-top:12px">
  <div style="font-size:1.6rem;font-weight:800" id="quizQ">Press Start</div>
  <div style="margin-top:8px" class="controls">
    <input id="quizInput" type="text" placeholder="Type your answer">
    <button id="quizCheck" class="secondary">Submit</button>
    <div id="quizFeedback" class="answer"></div>
  </div>
</div>
</section>

<section aria-labelledby="csvTitle">
<h2 id="csvTitle">Download CSV Log</h2>
<p>Track all practice & quiz answers in a CSV file.</p>
<button id="downloadCSVBtn" class="secondary">‚¨áÔ∏è Download CSV</button>
</section>

<footer>Mastering these identities is key to your success!</footer>
</main>
<script>
/* ===== Utilities ===== */
const tone = (f = 880, d = 0.06) => {
    try {
      const A = new (window.AudioContext || window.webkitAudioContext)();
      const o = A.createOscillator();
      const g = A.createGain();
      o.type = 'sine';
      o.frequency.value = f;
      g.gain.value = 0.0001;
      o.connect(g);
      g.connect(A.destination);
      o.start();
      g.gain.exponentialRampToValueAtTime(0.12, A.currentTime + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, A.currentTime + d);
      setTimeout(() => { o.stop(); A.close().catch(() => {}); }, d * 1000 + 50);
    } catch (e) {}
};
let totalScore = 0, streak = 0, csvData = [['Question', 'User Answer', 'Correct Answer']];
function updateScore(points) {
    if (points > 0) {
      totalScore += points;
      streak++;
    } else {
      streak = 0;
    }
    document.getElementById('score').textContent = `Score: ${totalScore}`;
    document.getElementById('streak').textContent = `Streak: ${streak}`;
}
window.check = (inputId, correct) => {
    const inputEl = document.getElementById(inputId);
    const val = inputEl.value.trim().toLowerCase();
    const resultId = 'r' + inputId.slice(1);
    const res = document.getElementById(resultId);
    if (!res) {
      console.error(`Result element with ID '${resultId}' not found.`);
      return;
    }
    const questionText = inputEl.previousElementSibling.textContent;
    const isCorrect = (val === correct);
    if (isCorrect) {
      res.textContent = '‚úÖ Correct!';
      res.className = 'answer ok';
      tone(880, 0.06);
      updateScore(1);
    } else {
      res.textContent = `‚ùå Wrong (Answer: ${correct})`;
      res.className = 'answer bad';
      tone(220, 0.06);
      updateScore(0);
    }
    csvData.push([questionText, val, correct]);
};
/* ===== Canvas Tutorial ===== */
const tutorialCanvas = document.getElementById('tutorialCanvas');
const ctx = tutorialCanvas.getContext('2d');
const tutorialSpeedInput = document.getElementById('videoSpeed');
const voice = window.speechSynthesis.getVoices().find(v => v.name.includes('female') || v.name.includes('F'));
function drawCircle(x, y, r, fill, stroke) {
    ctx.fillStyle = fill;
    ctx.strokeStyle = stroke;
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, 2 * Math.PI);
    ctx.fill();
    ctx.stroke();
}
function drawText(text, x, y, color = '#04263b', size = '24px') {
    ctx.textAlign = 'center';
    ctx.font = `${size} Inter, sans-serif`;
    ctx.fillStyle = color;
    ctx.fillText(text, x, y);
}
const tutorialSteps = [
    { audio: "The unit circle is a circle with a radius of one centered at the origin.", text: "The Unit Circle", viz: "circle" },
    { audio: "For any point (x, y) on the circle, x is the cosine of the angle and y is the sine.", text: "Coordinates are (cosŒ∏, sinŒ∏)", viz: "coords" },
    { audio: "The distance from the origin to the point is the radius, which is 1.", text: "Radius is 1", viz: "coords" },
    { audio: "Now, let's use the Pythagorean Theorem: x squared plus y squared equals r squared.", text: "Pythagorean Theorem: x¬≤ + y¬≤ = r¬≤", viz: "pythagorean" },
    { audio: "Substituting our values, we get cosine squared theta plus sine squared theta equals one squared.", text: "(cosŒ∏)¬≤ + (sinŒ∏)¬≤ = 1¬≤", viz: "pythagorean_sub" },
    { audio: "This simplifies to our first Pythagorean Identity: sine squared theta plus cosine squared theta equals one.", text: "sin¬≤Œ∏ + cos¬≤Œ∏ = 1", viz: "identity1" },
    { audio: "The other two identities are derived by dividing this first one by either cosine squared theta or sine squared theta.", text: "Deriving Other Identities", viz: "derivation" },
    { audio: "Dividing by cosine squared theta gives us one plus tangent squared theta equals secant squared theta.", text: "1 + tan¬≤Œ∏ = sec¬≤Œ∏", viz: "identity2" },
    { audio: "And dividing by sine squared theta gives us one plus cotangent squared theta equals cosecant squared theta.", text: "1 + cot¬≤Œ∏ = csc¬≤Œ∏", viz: "identity3" },
];
let tutorialIndex = 0;
async function playTutorialVideo(callback) {
    if (speechSynthesis.speaking) return;
    tutorialIndex = 0;
    const speed = parseFloat(tutorialSpeedInput.value) || 1;
    function nextStep() {
      if (tutorialIndex >= tutorialSteps.length) {
        if (callback) callback();
        return;
      }
      const step = tutorialSteps[tutorialIndex];
      const utterance = new SpeechSynthesisUtterance(step.audio);
      utterance.rate = speed;
      utterance.pitch = 1.2;
      utterance.volume = 1;
      if (voice) utterance.voice = voice;
      utterance.onend = () => {
        tutorialIndex++;
        nextStep();
      };
      utterance.onerror = () => {
        tutorialIndex++;
        nextStep();
      };
      ctx.clearRect(0, 0, tutorialCanvas.width, tutorialCanvas.height);
      drawText(step.text, tutorialCanvas.width / 2, 40);
      
      const centerX = tutorialCanvas.width / 2;
      const centerY = tutorialCanvas.height / 2 + 30;
      const radius = 100;
      
      if (step.viz === "circle" || step.viz === "coords" || step.viz === "pythagorean" || step.viz === "pythagorean_sub" || step.viz === "identity1") {
        drawCircle(centerX, centerY, radius, '#dbeafe', '#1d4ed8');
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.lineTo(centerX + radius, centerY);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.lineTo(centerX + radius * Math.cos(Math.PI/4), centerY - radius * Math.sin(Math.PI/4));
        ctx.stroke();
        drawCircle(centerX + radius * Math.cos(Math.PI/4), centerY - radius * Math.sin(Math.PI/4), 5, '#16a34a', '#16a34a');
      }
      if (step.viz === "coords") {
        drawText("(x, y)", centerX + radius * Math.cos(Math.PI/4) + 20, centerY - radius * Math.sin(Math.PI/4) - 20, '#16a34a', '16px');
        drawText("(cosŒ∏, sinŒ∏)", centerX + radius * Math.cos(Math.PI/4) + 40, centerY - radius * Math.sin(Math.PI/4) + 15, '#1d4ed8', '16px');
      }
      if (step.viz === "pythagorean" || step.viz === "pythagorean_sub" || step.viz === "identity1") {
        ctx.beginPath();
        ctx.moveTo(centerX + radius * Math.cos(Math.PI/4), centerY - radius * Math.sin(Math.PI/4));
        ctx.lineTo(centerX + radius * Math.cos(Math.PI/4), centerY);
        ctx.lineTo(centerX, centerY);
        ctx.strokeStyle = '#f97316';
        ctx.stroke();
        drawText("y", centerX + radius * Math.cos(Math.PI/4) + 10, centerY - radius * Math.sin(Math.PI/4) / 2, '#f97316', '16px');
        drawText("x", centerX + radius * Math.cos(Math.PI/4) / 2, centerY + 10, '#f97316', '16px');
        drawText("r=1", centerX + radius * Math.cos(Math.PI/8), centerY - radius * Math.sin(Math.PI/8), '#1d4ed8', '16px');
      }
      if (step.viz === "identity2") {
        drawText("$\\frac{\\sin^2\\theta}{\\cos^2\\theta} + \\frac{\\cos^2\\theta}{\\cos^2\\theta} = \\frac{1}{\\cos^2\\theta}$", centerX, centerY - 20);
      }
      if (step.viz === "identity3") {
        drawText("$\\frac{\\sin^2\\theta}{\\sin^2\\theta} + \\frac{\\cos^2\\theta}{\\sin^2\\theta} = \\frac{1}{\\sin^2\\theta}$", centerX, centerY - 20);
      }
      
      speechSynthesis.speak(utterance);
    }
    nextStep();
}
document.getElementById('playTutorial').addEventListener('click', () => playTutorialVideo());
ctx.font = '24px Inter, sans-serif';
ctx.textAlign = 'center';
ctx.fillText("Press Play to start the video!", tutorialCanvas.width / 2, tutorialCanvas.height / 2);
/* ===== Speed Quiz ===== */
function generateProblem() {
    const quizQuestions = [
      { q: "What is $\\tan\\theta$ in terms of $\\sin\\theta$ and $\\cos\\theta$?", a: "sin/cos" },
      { q: "What is $\\csc\\theta$ equal to?", a: "1/sin" },
      { q: "What is the simplified form of $1+\\cot^2\\theta$?", a: "csc^2" },
      { q: "What is $\\sec^2\\theta - 1$ equal to?", a: "tan^2" },
      { q: "What is $\\cos^2\\theta$ in terms of $\\sin^2\\theta$?", a: "1-sin^2" },
      { q: "What is the reciprocal of $\\tan\\theta$?", a: "cot" },
    ];
    return quizQuestions[Math.floor(Math.random() * quizQuestions.length)];
}
let quizTimerInt = null, quizTime = 0, quizScore = 0, currentQuiz = null;
function newQuizQuestion() {
    const problem = generateProblem();
    currentQuiz = problem;
    const qEl = document.getElementById('quizQ');
    qEl.textContent = currentQuiz.q;
    document.getElementById('quizInput').value = '';
    document.getElementById('quizFeedback').textContent = '';
    
    // Rerender MathJax for the new question
    if (window.MathJax) {
        window.MathJax.typesetPromise([qEl]).catch(err => console.error("MathJax typesetting failed", err));
    }
}
document.getElementById('startQuiz').addEventListener('click', () => {
    quizTime = parseInt(document.getElementById('quizDuration').value, 10);
    quizScore = 0;
    document.getElementById('quizScore').textContent = `Correct: ${quizScore}`;
    newQuizQuestion();
    clearInterval(quizTimerInt);
    quizTimerInt = setInterval(() => {
      quizTime--;
      document.getElementById('quizTimer').textContent = `Time: ${quizTime}s`;
      if (quizTime <= 0) {
        clearInterval(quizTimerInt);
        document.getElementById('quizQ').textContent = 'Time Up!';
      }
    }, 1000);
});
document.getElementById('stopQuiz').addEventListener('click', () => {
    clearInterval(quizTimerInt);
});
document.getElementById('quizCheck').addEventListener('click', () => {
    const val = document.getElementById('quizInput').value.trim().toLowerCase().replace(/ /g, '');
    const f = document.getElementById('quizFeedback');
    let userAnswer = val;
    let correctAnswer = currentQuiz.a.toLowerCase().replace(/ /g, '');
    let isCorrect = (val === correctAnswer);
    
    if (correctAnswer === "sin/cos" && (val === "tan" || val === "tan(theta)")) {
        isCorrect = true;
    } else if (correctAnswer === "1/sin" && (val === "csc" || val === "csc(theta)")) {
        isCorrect = true;
    } else if (correctAnswer === "csc^2" && (val === "csc^2(theta)" || val === "csc2")) {
        isCorrect = true;
    } else if (correctAnswer === "tan^2" && (val === "tan^2(theta)" || val === "tan2")) {
        isCorrect = true;
    } else if (correctAnswer === "1-sin^2" && (val === "cos^2" || val === "cos^2(theta)")) {
        isCorrect = true;
    } else if (correctAnswer === "cot" && (val === "cot(theta)" || val === "1/tan" || val === "cos/sin")) {
        isCorrect = true;
    }

    if (isCorrect) {
      f.textContent = '‚úÖ Correct!';
      f.className = 'answer ok';
      quizScore++;
      document.getElementById('quizScore').textContent = `Correct: ${quizScore}`;
      tone(880, 0.06);
    } else {
      f.textContent = `‚ùå Wrong (Answer: ${currentQuiz.a})`;
      f.className = 'answer bad';
      tone(220, 0.06);
    }
    csvData.push([currentQuiz.q, userAnswer, currentQuiz.a]);
    if (quizTime > 0) newQuizQuestion();
});
/* ===== CSV Download ===== */
document.getElementById('downloadCSVBtn').addEventListener('click', () => {
    const csvContent = "data:text/csv;charset=utf-8," + csvData.map(e => e.join(",")).join("\n");
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "trig_identities_log.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
});
</script>
</body>
</html>
